<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SB Admin - SOLID</title>

    <!-- Bootstrap core CSS-->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template-->
    <link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <!-- Page level plugin CSS-->
    <link href="../vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="../css/sb-admin.css" rel="stylesheet">

    <link rel="stylesheet" href="../styles/default.css">
    <script src="../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

  </head>

  <body id="page-top">

    <nav class="navbar navbar-expand navbar-dark bg-dark static-top">

      <a class="navbar-brand mr-1" href="index.html">Start Bootstrap</a>

      <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Navbar Search -->
      <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-primary" type="button">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </form>

      <!-- Navbar -->
      <ul class="navbar-nav ml-auto ml-md-0">
        <li class="nav-item dropdown no-arrow mx-1">
          <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-bell fa-fw"></i>
            <span class="badge badge-danger">9+</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
        <li class="nav-item dropdown no-arrow mx-1">
          <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-envelope fa-fw"></i>
            <span class="badge badge-danger">7</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="messagesDropdown">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
        <li class="nav-item dropdown no-arrow">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user-circle fa-fw"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <a class="dropdown-item" href="#">Settings</a>
            <a class="dropdown-item" href="#">Activity Log</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Logout</a>
          </div>
        </li>
      </ul>

    </nav>

    <div id="wrapper">

      <!-- Sidebar -->
      <ul class="sidebar navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="index.html">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>요약</span>
          </a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-fw fa-folder"></i>
            <span>목록</span>
          </a>
          <div class="dropdown-menu" aria-labelledby="pagesDropdown">
            <h6 class="dropdown-header">서론</h6>
            <a class="dropdown-item" href="../document/architect_001.html">서론</a>
            <div class="dropdown-divider"></div>
            <h6 class="dropdown-header">사례연구</h6>
            <a class="dropdown-item" href="../document/architect_002.html">사례연구</a>
            <div class="dropdown-divider"></div>
            <h6 class="dropdown-header">생성 패턴</h6>
            <a class="dropdown-item" href="../document/architect_003.html">추상 팩토리</a>
            <a class="dropdown-item" href="../document/architect_004.html">빌더</a>
            <a class="dropdown-item" href="../document/architect_005.html">팩토리 메서드</a>
            <a class="dropdown-item" href="../document/architect_006.html">원형</a>
            <a class="dropdown-item" href="../document/architect_007.html">단일체</a>
            <a class="dropdown-item" href="../document/architect_008.html">생성 패턴에 대한 논의</a>
            <div class="dropdown-divider"></div>
            <h6 class="dropdown-header">구조 패턴</h6>
            <a class="dropdown-item" href="../document/architect_009.html">적응자</a>
            <a class="dropdown-item" href="../document/architect_010.html">가교</a>
            <a class="dropdown-item" href="../document/architect_011.html">복합체</a>
            <a class="dropdown-item" href="../document/architect_012.html">장식자</a>
            <a class="dropdown-item" href="../document/architect_013.html">퍼사드</a>
            <a class="dropdown-item" href="../document/architect_014.html">플라이급</a>
            <a class="dropdown-item" href="../document/architect_015.html">프록시</a>
            <a class="dropdown-item" href="../document/architect_016.html">구조패턴에 대한 논의</a>
            <div class="dropdown-divider"></div>
            <h6 class="dropdown-header">행동 패턴</h6>
            <a class="dropdown-item" href="../document/architect_017.html">책임 연쇄</a>
            <a class="dropdown-item" href="../document/architect_018.html">명령</a>
            <a class="dropdown-item" href="../document/architect_019.html">해석자</a>
            <a class="dropdown-item" href="../document/architect_020.html">반복자</a>
            <a class="dropdown-item" href="../document/architect_021.html">중재자</a>
            <a class="dropdown-item" href="../document/architect_022.html">메멘토</a>
            <a class="dropdown-item" href="../document/architect_023.html">감시자</a>
            <a class="dropdown-item" href="../document/architect_024.html">상태</a>
            <a class="dropdown-item" href="../document/architect_025.html">전략</a>
            <a class="dropdown-item" href="../document/architect_026.html">템플릿 메서드</a>
            <a class="dropdown-item" href="../document/architect_027.html">방문자</a>
            <a class="dropdown-item" href="../document/architect_028.html">행동 패턴에 대한 논의</a>
            <div class="dropdown-divider"></div>
            <h6 class="dropdown-header">결론</h6>
            <a class="dropdown-item" href="../document/architect_029.html">디자인 패턴에서 무엇을<br> 기대할 수 있는가?</a>
            <a class="dropdown-item" href="../document/architect_030.html">간략한 역사</a>
            <a class="dropdown-item" href="../document/architect_031.html">패턴 커뮤니티</a>
            <a class="dropdown-item" href="../document/architect_032.html">초대의 글</a>
            <a class="dropdown-item" href="../document/architect_033.html">책을 마무리하며</a>
            <div class="dropdown-divider"></div>
            <h6 class="dropdown-header">System Archtecture</h6>
            <a class="dropdown-item" href="../document/architect_053.html">API with Zuul</a>
            <a class="dropdown-item" href="../document/architect_037.html">Cloud System</a>
            <a class="dropdown-item" href="../document/architect_047.html">Cassandra</a>
            <a class="dropdown-item" href="../document/architect_036.html">DevOps</a>
            <a class="dropdown-item" href="../document/architect_045.html">IAC</a>
            <a class="dropdown-item" href="../document/architect_043.html">Kuberneties</a>
            <a class="dropdown-item" href="../document/architect_034.html">MVC</a>
            <a class="dropdown-item" href="../document/architect_049.html">MSA</a>
            <a class="dropdown-item" href="../document/architect_044.html">MOM</a>
            <a class="dropdown-item" href="../document/architect_039.html">PAAS</a>
            <a class="dropdown-item" href="../document/architect_035.html">REST API</a>
            <a class="dropdown-item" href="../document/architect_046.html">SAAS</a>
            <a class="dropdown-item" href="../document/architect_040.html">SCA</a>
            <a class="dropdown-item" href="../document/architect_042.html">SOA</a>
            <a class="dropdown-item" href="../document/architect_041.html">TDD(DDD)</a>
            <a class="dropdown-item" href="../document/architect_048.html">Web Cache</a>
            <a class="dropdown-item" href="../document/architect_050.html">Various Pattern</a>
          </div>
        </li>
      </ul>

      <div id="content-wrapper">
        <div class="container-fluid">
          <!-- Breadcrumbs-->
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="#">Dashboard</a>
            </li>
            <li class="breadcrumb-item active">Memory Visibility & Memory Barrier</li>
          </ol>

          <!-- Area Chart Example-->
          <div class="card mb-3">
            <div class="card-header">
                
            </div>
            <div class="card-body">
                Java의 메모리 모델을 공부하다 보면 그 중요 위치에 메모리 가시성과 메모리 장벽이라는 것이 등장한다. <br>
                비단 Java의 메모리 모델에서 뿐만 아니라 Concurrent Programming에서도 주요 고려사항으로 이 메모리 가시성과 메모리 장벽이 언급된다. <br>

                <hr>
                <Strong>메모리 가시성(Memory Visibility)</Strong>
                <hr>

                우선 Concurrent Programming , Parallel Programming과 관련하여 메모리 가시성(Memory Visibility)라는 것을 간단히 정리하면, 
                한 Thread에서 변경한 특정 메모리의 값이, 다른 Thread에서 제대로 읽어지는지가 라고 할 수 있다. 
                
                그런데 이 메모리 가시성이 중요한 이슈가 되는 경우는 다중 CPU, 다중 코어에서다. 
                Thread가 여러 코어(CPU)에서 동시에 실행되는 상황에서 이 메모리 가시성은 중요한 고려 사항이 된다.
                다중 코어(CPU)에서 메모리 가시성 문제가 발생하는 첫번째 이유는, 앞선 글에서도 언급했지만 CPU의 메모리 아키텍처,
                즉 레지스터와 캐쉬의 존재 때문이다. 각각의 코어(CPU)는 메인 메모리와 별도로 각각의 레지스터와 캐쉬를 가지기 때문이다. 
                다중 코어(CPU)에서 메모리 가시성 문제가 발생하는 두번째 이유는, 컴파일러 최적화 때문이다.
                컴파일러는 프로그램이 최대한 빠르게 실행될 수 있도록 코어(CPU)의 레지스터와 캐쉬를 사용하도록 최적화 하기 때문인 것이다. 
                
                결국 Shared Memory 모델의 Concurrent, Parallerl Programming 에서는, 한 코어(CPU)에서의 값 변경을 여러 코어(CPU)가 
                공유하는 메인 메모리로 반영하는 작업을 적절히 수행해야 메모리 가시성을 유지할 수 있게 된다. 
                익히 알고 있겠지만 코어(CPU)의 레지스터나 캐쉬의 값을 메인 메모리로 반영하는 것은 느리다. 하지만 꼭 필요하다. 
                따라서 결론은 적절히 필요한 시점에만 메인 메모리로 반영하도록 하는 것이 필요하다. 
                그래서 등장하는 개념이 바로 메모리 장벽(Memory Barrier)이다. 
                <hr>
                <Strong>메모리 장벽( Memory Barrier )</Strong>
                <hr>
                이 메모리 장벽(Memory Barrier)은 Memory Fence라고도 하는데 간단히 정리하면, 
                이 메모리 장벽을 만나기 전, 그전까지 코어(CPU)의 레지스터나 캐쉬값의 변경을 메인 메모리에 반영하는 것이라고 할 수 있다. 
                이를 메인 메모리로 Flush 한다고도 하는데, 이렇게 함으로써 다른 코어(CPU)에서 변경된 값을 읽을 수 있도록 하는 것이다. 
                
                이 메모리 장벽을 사용하려면 결국 컴파일러가 어떤 식으로든 메모리 장벽을 설치하도록 지시해야 하는데,
                일반적으로 동기화를 위한 Lock 을 사용하는 곳에는 암시적으로 메모리 장벽이 설치된다. Lock 이라는 것도 결국 Lock을 소유하는 코어(Core)가 특정 메모리에 표시를 해 두면, 
                다른 코어(CPU)가 그 값을 보고 자신이 Lock를 소유할 수 없는 상태라는 것을 판단해야 하기 때문에, 이 Lock을 위한 메모리를 쓰고 읽는 과정에서 메모리 장벽이 필수적으로 들어가야 한다. 
                Java를 예로 들면, synchronized 블록의 진입과 탈출 시에는 메모리 장벽을 거치게 되는 것이다. 전문가들이 Thread간에 공유되는 데이터를 읽고 쓰는 경우에는 항상 synchronized 블록으로 묶어 주라고 하는 이유도 바로 여기에 있다. 

                <hr>
                
                이 메모리 가시성과 메모리 장벽과 관련하여 C, C++,Java 같은 언어에서 최근에 등장하는 Atomic***로 
                표현되는 라이브러리들이 있는데, 사실 나는 처음에는 Java의 AtomicInteger같은 것이 필요한 이유를 알 수 없었다. 
                32bit 기반의 CPU에서 int 값을 읽고 쓰는 것은 동기화가 필요 없이 원자적으로(atomic)하게 실행되기 
                때문에 이를 위해 AtomicInteger라는 클래스를 따로 만들 이유가 없어보였다.(물론 이 AtomicInteger는 
                incrementAndGet() 같은 편이 메소드가 있지만 이 메소드를 사용하지 않더라도 AtomicInteger를 사용해야 하는 상황을 이야기 하는 것이다. ) 
                <hr>
                하지만 이 Atomic***를 사용해야 하는 제일 중요한 이유는 메모리 가시성 때문이다.
                이 Atomic***에 값을 쓰거나 읽는 것은 레지스터나 캐쉬가 아니라 바로 메인 메모리에서  
                수행되도록 해주는 것이다. 따라서 무거운 synchronized 블록으로 변수를 묶지 않고도, 메모리 가시성을 확보할 수 있게 된다. 
                (Java에선는 volatile도 이 Atomic***와 같은 역할을 한다고 할 수 있지만, 
                이 volatile은 예전부터 여러 Java 구현체(implementor)에서 그 기능이 명확하지 않아 혼란을 초래했기 때문에 Atomic***을 새로 만든 것 같다. ) 
                <hr>
                메모리 장벽은 재배치(reordering)과 관련한 내용도 있다. 
                요지는, 컴파일러는 메모리 장벽을 넘어서까지 재배치를 하지는 않는다는 것이다. 
                이 역시도 생각해보면, 메모리 장벽은 이전 까지 메모리 작업을 메인 메모리로 반영하는 것인데,
                이때 그 메모리 장벽 이전까지라는 것은 프로그래머가 코드에 표현한 순서로 메모리 장벽 이전까지가 된다.
                따라서 컴파일러는 이 메모리 장벽을 넘어서는 재배치(reordering)은 하지 않게 되는 것이다. 
                
            </div>
        </div>
        <!-- /.container-fluid -->

        <!-- Sticky Footer -->
        <footer class="sticky-footer">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright © Your Website 2018</span>
            </div>
          </div>
        </footer>

      </div>
      <!-- /.content-wrapper -->

    </div>
   
    <!-- /#wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
          <div class="modal-footer">
            <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
            <a class="btn btn-primary" href="login.html">Logout</a>
          </div>
        </div>
      </div>
    </div>

    <script language="JavaScript">

        var timerID;      // 타이머를 핸들링하기 위한 전역 변수
        var time = 1200;   // 타이머 시작시의 시간
    
        document.getElementById("btnStart").addEventListener("click", function(){
          start_timer();
        });
    
        /* 타이머를 시작하는 함수 */
        function start_timer() { 
          timerID = setInterval("decrementTime()", 1000);
    
        }
    
        /* 남은 시간을 감소시키는 함수 */
    
        function decrementTime() { 
    
          var x1 = document.getElementById("time1");
    
          x1.innerHTML = toHourMinSec(time);
    
          if(time > 0){
            time--;
          } else { 
    
            // 시간이 0이 되었으므로 타이머를 중지함
            clearInterval(timerID);
            x1.innerHTML = "종료!!"
          }
        }
    
        /* 정수형 숫자(초 단위)를 "시:분:초" 형태로 표현하는 함수 */
        function toHourMinSec(t) { 
          var hour;
          var min;
          var sec;
    
          // 정수로부터 남은 시, 분, 초 단위 계산
          hour = Math.floor(t / 3600);
          min = Math.floor( (t-(hour*3600)) / 60 );
          sec = t - (hour*3600) - (min*60);
    
          // hh:mm:ss 형태를 유지하기 위해 한자리 수일 때 0 추가
          if(hour < 10) hour = "0" + hour;
          if(min < 10) min = "0" + min;
          if(sec < 10) sec = "0" + sec;
    
          return(hour + ":" + min + ":" + sec);
    
        }
    
      </script>
    <!-- Bootstrap core JavaScript-->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="../vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Page level plugin JavaScript-->
    <script src="../vendor/chart.js/Chart.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="../js/sb-admin.min.js"></script>

    <!-- Demo scripts for this page-->
    <script src="../js/demo/chart-area-demo.js"></script>
    <script src="../js/demo/chart-bar-demo.js"></script>
    <script src="../js/demo/chart-pie-demo.js"></script>

  </body>

</html>
