<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>1lines - Blockchain</title>

    <!-- Bootstrap core CSS-->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template-->
    <link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <!-- Page level plugin CSS-->
    <link href="../vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="../css/sb-admin.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles/default.css">
    <script src="../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>

  <body id="page-top">

    <nav class="navbar navbar-expand navbar-dark bg-dark static-top">

      <a class="navbar-brand mr-1" href="./index.html">1 Lines</a>

      <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Navbar Search -->
      

      <!-- Navbar -->
      

    </nav>

    <div id="wrapper">

      <!-- Sidebar -->
      <ul class="sidebar navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="./index.html">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>요약</span>
          </a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-fw fa-folder"></i>
            <span>목록</span>
          </a>
          <div class="dropdown-menu" aria-labelledby="pagesDropdown">
            <h6 class="dropdown-header">Blockchain</h6>
            <a class="dropdown-item" href="../blockchain/blockchain_001.html">Blockchain 001</a>
            <a class="dropdown-item" href="../blockchain/blockchain_002.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_003.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_004.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_005.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_006.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_007.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_008.html"></a>          
            <a class="dropdown-item" href="../blockchain/blockchain_009.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_010.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_011.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_012.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_013.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_014.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_015.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_016.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_017.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_018.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_019.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_020.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_021.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_022.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_023.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_024.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_025.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_026.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_027.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_028.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_029.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_030.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_031.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_032.html"></a>
            <a class="dropdown-item" href="../blockchain/blockchain_033.html"></a>
          </div>
        </li>
      </ul>

      <div id="content-wrapper">
        <div class="container-fluid">
          <!-- Breadcrumbs-->
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="#">Dashboard</a>
            </li>
            <li class="breadcrumb-item active">blockchain</li>
          </ol>
          <div class="accordion" id="accordionExample">
              <div class="card">
                <div class="card-body">
                  <strong>Solidity</strong>
                  <hr>
                  솔리디티에서는 부동 소수점 자료형을 지원하지 않도 다양한 자료형을 지원합니다. <br>
                  부동소수점 타입으로는 수를 정확하게 표현하지 못하기 때문에 수를 정확히 다룰 수 없는 타입은 이더를 다룰 수 없어, 솔리디티는 부동소수점을 지원하지 않습니다. 
                  주요 자료형 
                  <pre>
                    <code>
  uint 
  int
  bool
  string
  bytes
  address                    
                    </code>
                  </pre>
                  레퍼런스 자료형
                  <pre>
                    <code>
  배열
  구조체 
                    </code>
                  </pre>
                  <hr>
                  <ul>
                    <li>논리 연산자 : !, &&, ||</li>
                    <li>비교 연산자 : &lt;=, &lt;, ==, !=, >=, ></li>
                    <li>비트 연산자 : &, |, ^, &lt;&lt;, >> (시프트 연산자)</li>
                    <li>단항 산술 연산자 : +, -</li>
                    <li>이항 산술 연산자 : +, -, *, / (몫), % (나머지), ** (거듭 제곱)</li>
                  </ul>
                  <ul>
                    <li>조건문 : if, else, ? : (삼항 연산자)</li>
                    <li>반복문 : while, do, for</li>
                    <li>반복문 분기 : break, continue</li>
                    <li>반환문 : return</li>
                  </ul>
                  솔리디티는 자동 형 변환을 하지 않습니다. 예를 들어 if (true) { ... }는 허용하지만 if (1) { ... }는 허용하지 않습니다.
                  <hr>
                  <strong>이더리움 송금</strong> <br>
                  사람 뿐만 아니라, 스마트 계약도 내부적으로 이더리움 계정을 가집니다. 
                  스마트 계약은 계약 계정을 통해 이더를 거래합니다. 
                  <br> 
                  Payable 키워드는 계약 계정에 외부에서 이더를 송금 받을 수 있도록 합니다. 즉, 계약이 A에게 송금을 받으려면 A가 호출하는 함수에 payable 함수가 있어야합니다. 
                  <br>
                  이를 계약 계정 ( Contract Accounts, CA)라고 합니다. 
                  <pre>
                    <code>
  function 함수이름() payable public {
    // 함수 내용 
  }                    
                    </code>
                  </pre>
                  <hr>
                  <strong>메세지 프로퍼티 (Message Properties)</strong> <br>
                  gas limit : 그 계약에서 한번의 호출로 소비할 수 있는 최대의 가스양 
                  <br>
                  <ul>
                    <li>data | byte | 호출 데이터 </li>
                    <li>sender | address | 계약을 호출한 이더리움 주소 </li>
                    <li>value | uint | 계약을 호출한 이더리움 주소 </li>
                    <li>gas | unit | gas limit 에서 함수를 호출하고 남은 가스  </li>
                  </ul>
                  <hr>
                  <strong>이더리움 송금</strong> <br>
                  Tranfer 함수 : transfer 함수를 사용하면 계약이 다른 이에게 이더를 전송합니다. 
                  transfer 함수는 아래와 같이 사용합니다. <br>
                  msg.sender 가 함수를 호출할 때 수수료를 지불했기 때문입니다. 
                  <pre>
                    <code>
  &lt;받는 사람의 주소>.transfer(&lt;송금할 금액>);       
  
  function buy() public {
    seller.transfer(10)
  }
                    </code>
                  </pre>
                  <hr>
                  <strong>계약 수수료, Gas</strong><br>
                  작성된 스마트 계약은 EVM ( Ethereum Virtual Machine )타깃으로 컴파일 된 후, 이더리움 네트워크에 배포됩니다. 이렇게 배포된 스마트 계약 코드는 Gas라는 수수료를 내야 사용할 수 있습니다.  <br>
                  스마트 계약은 실제로 블록체인을 관리하는 노드들에 의해 실행됩니다. 이때 노드는 데이터를 검증하고, 기록하는 등 다양한 일을 해줍니다. 
                  따라서 이 일을 해주는 대가로 Gas라고 부르는 수수료를 내야합니다. 스마트 계약에 명령어가 많을 수록 Gas를 더 많이 내야 합니다. 
                  <hr>
                  <strong>계약기록, 트랜잭션(Transaction)</strong><br>
                  스마트 계약을 실행하면 이더리움 블록체인에 기록이 남습니다. 이 기록은 트랜잭션(Transaction)이라는 특수한 형태로 
                  저장되는데, 트랜잭션은 계약을 수행하는데 든 수수료(가스) 등 다양한 정보를 담고 있습니다. 
                  <ul>
                    <li>transactionHash : 트랜잭션의 해시값</li>
                    <li>transactionIndex : 트랜잭션의 인덱스 값</li>
                    <li>blockHash : 이 트랜잭션이 추가된 블록의 해시값 </li>
                    <li>blockNumber :이 트랜잭션이 추가된 블록의 번호 </li>
                    <li>gasUsed : 이 트랜잭션 호출에 소비한 가스양 </li>
                    <li>cumulativeGasUsed : 누적으로 사용된 가스량</li>
                    <li>contractAddress : 계약의 주소</li>
                    <li>logs : event로 로깅된 정보 ( 후속 강의로 다룰 예정 )</li>
                  </ul>
                  이런 트랜잭션들이 모여 하나의 블록(block)을 이룹니다. 이더리움 네트워크 상에는 이러한 블록들이 체인처럼 엮인 모습을 하고 있기 때문에 블록체인(blockchain)이라고 부릅니다.
                  <hr>

                </div>  
              </div>
              <div class="card">
                <div class="card-body">
                  <ul>
                    <li>가나슈 : 내컴퓨터에서 이더리움 블록 체인을 실행해볼수 있도록 도와주는 역할 </li>
                    <li>솔리디티 : 스마트 컨트랙트 작성을 위해 쓸 언어</li>
                    <li>EVM(Ethereum Virtual Machine)</li>
                    <li>RPC(Remote Procedure Call)</li>
                    <li>Web3.js</li>
                  </ul>
                  <strong>MacOS 개발환경 설정</strong><br>
                  <pre>
                    <code class="shell" >
brew update
brew install nodejs
mkdir  -p ethereum_voting_dapp/chapter1 
cd ethereum_voting_dapp/chapter1 
npm install ganache-cli web3@0.20.3 solc
node_modules/.bin/ganache-cli 
                    </code>
                  </pre>
                  실제 실행 예제 
                  <pre>
                    <code class="shell" >
dreamui-MacBook-Pro:chapter1 dream$ node_modules/.bin/ganache-cli
Ganache CLI v6.12.2 (ganache-core: 2.13.2)

Available Accounts
==================
(0) 0x4FEecc563883e285d0cb94004659b905e5d4dd42 (100 ETH)
(1) 0xd900F964e230316774770aed28d950006715f6f7 (100 ETH)
(2) 0xd5f225Eb6F3b2286e4B33208A71998f199181740 (100 ETH)
(3) 0x014ab6C9113b2f0FF63AaaBD2d3fA7B745625D4C (100 ETH)
(4) 0x4B13b9DBe04886D8757FA894AD7f38767E4E32a4 (100 ETH)
(5) 0x2E64a8d330f256D81f33fBF1e28C80f997b99936 (100 ETH)
(6) 0x75670cb0aEfb4902d87910Cf1c3a41d524dE46D7 (100 ETH)
(7) 0x5777C7F29140D743D4FD7AD0B9F310b8f65c38e5 (100 ETH)
(8) 0xE5c3fb61F8E86D45fBe6872BB07F350fe4b7f58f (100 ETH)
(9) 0x7a9D56cF047cCAaBA6a12d45686e1DCAA24Eb16c (100 ETH)

Private Keys
==================
(0) 0x4b526bf7be4cd0299c2e65b04d2bc4ca74c826ffe677085c359b724f9b9c9713
(1) 0x314f83368e190e67e1771e9f7c59b015c7223461a6f9c72c567aa84c64899aab
(2) 0x7a5e92cc9c23abb8ced68301ab34a8c0688096ad722957b08270dcc77cfdb042
(3) 0x02574f37f6a4c18354b52ea682b90f78f8898c3e72257239604fa979fa7e8bc3
(4) 0x2ad3e5e527be640889b937dfb13864d18873ff538169227c0ba2bf4bf9bbb891
(5) 0xf092955ea44d3c971022f1c2bb0e0c10b0f3ebca3a922d0e689b6c5c97dec426
(6) 0xb34a11b4bd56fb026a7fb03843c69d78a16ec0fd331438bc8e65200deb38b6e5
(7) 0xd0bedbbb905dadee7b68ded41dc72e938b57401568ee601c46943c1b91bb2b4c
(8) 0x07e93abea438d687b827f1b4d5f801b41529e670fc463ab9744ce53553c863e5
(9) 0x3bc1c00ba633a4142faae2ea6ce67368b979b3fe0ab1c7ebce4667bdc3728768

HD Wallet
==================
Mnemonic:      predict sea prepare lake clump regular wheel wood marine whisper enforce setup
Base HD Path:  m/44'/60'/0'/0/{account_index}

Gas Price
==================
20000000000

Gas Limit
==================
6721975

Call Gas Limit
==================
9007199254740991                      
                    </code>
                  </pre>
                  <hr>
                  <strong>Linux 개발 환경 설정</strong>
                  <pre>
                    <code class="shell" >
sudo apt-get update
curl -sL https://deb.nodesource.com/setup_7.x -o nodesource_setup.sh
sudo bash nodesource_setup.sh
sudo apt-get install nodejs
node --version
v7.4.0
npm --version
4.0.5
mkdir -p ethereum_voting_dapp/chapter1
cd ethereum_voting_dapp/chapter1
npm install ganache-cli web3@0.20.1 solc
node_modules/.bin/ganache-cli
                    </code>
                  </pre>
                  <hr>
                  <strong>Solidity 공부</strong>
                  <pre>
                    <code class="shell" >
pragma solidity ^0.4.23;

contract Voting {
    //  constructor to initialize candidates
    //  vote for candidates
    //  get count for votes for each candidates
    
    
    bytes32[] public candidateList;
    mapping (bytes32 => uint8) public votesReceived;
    
    // when contract publishing,
    constructor(bytes32[] candidateNames) public {
        candidateList = candidateNames;
    }
    
    function voteForCandidate(bytes32 candidate) public {
        require(validCandidate(candidate));
        votesReceived[candidate] += 1;
    }
    
    function totalVotesFor(bytes32 candidate) view public returns(uint8) {
        require(validCandidate(candidate));
        return votesReceived[candidate];
    }
    
    function validCandidate(bytes32 candidate) view public returns(bool) {
        for(uint i = 0; i &lt; candidateList.length ; i ++){
            if(candidateList[i] == candidate) {
                return true;
            }
        }
        return false;
    }
    
}
                    </code>
                  </pre>
                  <hr>
                  <strong>solidity compile</strong><br>
                  <pre>
                    <code class="shell" >
root@00a8f8f4d1ed:/home/test/ethereum_voting_dapp/chapter1# node_modules/.bin/solcjs --bin --abi Voting.sol 

drwxr-xr-x  3 root root  4096 Feb 21 14:09 .
drwxr-xr-x  3 root root  4096 Feb 12 12:09 ..
-rw-r--r--  1 root root  1002 Feb 21 14:08 Voting.sol
-rw-r--r--  1 root root  1103 Feb 21 14:09 Voting_sol_Voting.abi
-rw-r--r--  1 root root  4034 Feb 21 14:09 Voting_sol_Voting.bin
drwxr-xr-x 36 root root  4096 Feb 12 12:21 node_modules
-rw-r--r--  1 root root 25576 Feb 12 12:21 package-lock.json
                    </code>
                  </pre>
                  생성한 solidity.sol 파일에 대해서 아래와 같이 컴파일해서 배포할 수 있다. <br>

                  <strong>node console - compile </strong>
                  <pre>
                    <code class="shell" > 
code = fs.readFileSync('Voting.sol').toString();
solc = require('solc');
compileCode = solc.compile(code);
                    </code>
                  </pre>


                  Compile시 에러 대응 ( 2021-02-22 ) : 인자에 memory를 붙이지 않아 에러가 발생함. storage와 memory에 대해서 공부 필요 <br>
                  <ul>
                    <li>
                      storage : 함수 호출 사이에서 데이터를 저장하는 곳 <br>
                      <pre>
                        <code>
// storage에 저장된다.                           
bytes32[] public candidateList;
                        </code>
                      </pre>


                    </li>
                    <li>memory : 임시적인 데이터 저장소로 사용 

                      <pre>
                        <code>
// memory - call by value
int[] memory myLines = numbers;

// storage - call by reference
int[] storage myLines = numbers;
                        </code>
                      </pre>
                    </li>
                  </ul>
                  Sol 파일을 컴파일 하면 아래의 2개의 파일이 나옴 <br>
                  <ul>
                    <li>.abi</li>
                    <li>.bin</li>
                  </ul>
                  <hr>
                  <strong>contract 배포하기</strong><br>
                  <pre>
                    <code class="nodejs" >
web3 = require('web3')

web3 = new web3("http://localhost:8545")

bytecode = fs.readFileSync('./Voting_sol_Voting.bin').toString();

abi = fs.readFileSync('./Voting_sol_Voting.abi').toString();

// Json Parser를 이용한 abi 확인
abi = JSON.parse(fs.readFileSync('./Voting_sol_Voting.abi').toString())

deployedContract = new web3.eth.contract(abi)

// node 실행을 위한 아래 파일 생성

deployedContract.deploy({
        data: bytecode,
        arguments : [['Rama', 'Nick', 'Jose'].map(name => web3.toAscii(name))]
}).send({
        from : '0x4FEecc563883e285d0cb94004659b905e5d4dd42',
        gas : 1500000,
        gasPrice : web3.utils.toWei('0.0003', 'ether')
}).then((newContractInstance) => {
        deployedContract.options.address = newContractInstance.options.address;
})

web3.utils.asciiToHex('Rama')

                    </code>
                  </pre>

                  <pre>
                    <code class="nodejs" >
// https://gist.github.com/tomconte/4edb83cf505f1e7faf172b9252fff9bf 해당 링크 참고 소스                       
const fs = require('fs');
const solc = require('solc');
const Web3 = require('web3');

// Connect to local Ethereum node
const web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));

// Compile the source code
const input = fs.readFileSync('Token.sol');
const output = solc.compile(input.toString(), 1);
const bytecode = output.contracts['Token'].bytecode;
const abi = JSON.parse(output.contracts['Token'].interface);

// Contract object
const contract = web3.eth.contract(abi);

// Deploy contract instance
const contractInstance = contract.new({
    data: '0x' + bytecode,
    from: web3.eth.coinbase,
    gas: 90000*2
}, (err, res) => {
    if (err) {
        console.log(err);
        return;
    }

    // Log the tx, you can explore status with eth.getTransaction()
    console.log(res.transactionHash);

    // If we have an address property, the contract was deployed
    if (res.address) {
        console.log('Contract address: ' + res.address);
        // Let's test the deployed contract
        testContract(res.address);
    }
});

// Quick test the contract

function testContract(address) {
    // Reference to the deployed contract
    const token = contract.at(address);
    // Destination account for test
    const dest_account = '0x002D61B362ead60A632c0e6B43fCff4A7a259285';

    // Assert initial account balance, should be 100000
    const balance1 = token.balances.call(web3.eth.coinbase);
    console.log(balance1 == 1000000);

    // Call the transfer function
    token.transfer(dest_account, 100, {from: web3.eth.coinbase}, (err, res) => {
        // Log transaction, in case you want to explore
        console.log('tx: ' + res);
        // Assert destination account balance, should be 100 
        const balance2 = token.balances.call(dest_account);
        console.log(balance2 == 100);
    });
}
                    </code>
                  </pre>

                  
                </div>
              </div>
            </div>
            <div class="card-footer small text-muted"></div>
        </div>
        <!-- /.container-fluid -->

        <!-- Sticky Footer -->
        <footer class="sticky-footer">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright © 1Lines Labs 2019</span>
            </div>
          </div>
        </footer>

      </div>
      <!-- /.content-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    

    <script language="blockchainScript">

        var timerID;      // 타이머를 핸들링하기 위한 전역 변수
        var time = 600;   // 타이머 시작시의 시간
    
        document.getElementById("btnStart").addEventListener("click", function(){
          start_timer();
        });
    
        /* 타이머를 시작하는 함수 */
        function start_timer() { 
          timerID = setInterval("decrementTime()", 1000);
    
        }
    
        /* 남은 시간을 감소시키는 함수 */
    
        function decrementTime() { 
    
          var x1 = document.getElementById("time1");
    
          x1.innerHTML = toHourMinSec(time);
    
          if(time > 0){
            time--;
          } else { 
    
            // 시간이 0이 되었으므로 타이머를 중지함
            clearInterval(timerID);
            x1.innerHTML = "종료!!"
          }
        }
    
        /* 정수형 숫자(초 단위)를 "시:분:초" 형태로 표현하는 함수 */
        function toHourMinSec(t) { 
          var hour;
          var min;
          var sec;
    
          // 정수로부터 남은 시, 분, 초 단위 계산
          hour = Math.floor(t / 3600);
          min = Math.floor( (t-(hour*3600)) / 60 );
          sec = t - (hour*3600) - (min*60);
    
          // hh:mm:ss 형태를 유지하기 위해 한자리 수일 때 0 추가
          if(hour < 10) hour = "0" + hour;
          if(min < 10) min = "0" + min;
          if(sec < 10) sec = "0" + sec;
    
          return(hour + ":" + min + ":" + sec);
    
        }
    </script>

    <!-- Bootstrap core blockchainScript-->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin blockchainScript-->
    <script src="../vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Page level plugin blockchainScript-->
    <script src="../vendor/chart.js/Chart.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="../js/sb-admin.min.js"></script>

    <!-- Demo scripts for this page-->
    <script src="../js/demo/chart-area-demo.js"></script>
    <script src="../js/demo/chart-bar-demo.js"></script>
    <script src="../js/demo/chart-pie-demo.js"></script>

  </body>

</html>
